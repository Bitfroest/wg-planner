extends layout-customer

block head

block content
	h1.page-header= title
	
	h2.sub-header Infos
	
	form(method='post', action='/shopping_list/update')
		input(type='hidden', name='_csrf', value=_csrf)
		input(type='hidden', name='id', value=shoppingList.id)
		table.table.table-striped
			tr
				td Laden
				td
					input.form-control(type='text', name='shop', value=shoppingList.shop_name)
				td= shoppingList.shop_name
			tr
				td Einkäufer
				td
					script(type="application/javascript")
						|function changeBuyerButton(value,name){
						|	console.log("v:"+value+" n:"+name);
						|	document.getElementById('change-buyer').value = value;
						|	document.getElementById('buyer-button-text').textContent = name+" ";
						|};	
					input#change-buyer(type='hidden', name='buyer')
					div.input-group
						div.input-group-btn
							button.btn.btn-default.dropdown-toggle#buyer-button(type='button', data-toggle='dropdown', size='1')
								span#buyer-button-text -- Wähle Käufer --
								span.caret
							ul.dropdown-menu(role='menu')
								each member in members
									li
										a(onclick='changeBuyerButton('+member.id+',"'+member.name+'")' value=member.id)= member.name
									if shoppingList.buyer_id == member.id
										script(type="application/javascript")
											|changeBuyerButton(
											= member.id
											|,"
											= member.name
											|");
				td= shoppingList.buyer_name
			tr
				td Wann?
				td
					span.input-group.input-flex
						input.form-control(type='text', name='shopped_date', value=formatDate(shoppingList.shopped, 'date'))
						input.form-control(type='text', name='shopped_time', value=formatDate(shoppingList.shopped, 'time'))
				td= formatDate(shoppingList.shopped)
			tr
				td Erstellt
				td= 'von ' + shoppingList.creator_name + ' am ' + formatDate(shoppingList.created)
		input.btn.btn-primary(type='submit', value='Ändern')

	
	div
		form(method='post', action='/shopping_list/delete')
			input(type='hidden', name='_csrf', value=_csrf)
			input(type='hidden', name='id', value=shoppingList.id)
			input.btn.btn-danger(type='submit', value='Löschen')
	
	h2.sub-header Kassenzettel
	
	form(method='post', action='/shopping_list/receipt')
		input(type='hidden', name='_csrf', value=_csrf)
		input(type='hidden', name='id', value=shoppingList.id)
		span
			input(type='file', name='receipt' , accept='image/*;capture=camera')
		input.btn.btn-primary(type='submit', value='Hochladen')
	
	h2.sub-header Anteile
	
	table.table.table-striped
		each person in stats
			tr
				td= person.name
				td= formatCurrency(person.total)
		tr
			th Gesamt
			th= formatCurrency(shoppingList.total_price)
	
	h2.sub-header Items
	
	input.hidden(value=shoppingList.id id="shoppingListId")
	input.hidden(id='_csrf', value=_csrf)
	div(ng-app='shopping_list', ng-controller='ShoppingListController as slc')
		table.table.table-striped
			tr(ng-repeat='item in shopping_items')
				td
					a.btn.btn-primary(href='/shopping_item/{{item.id}}')
						i.glyphicon.glyphicon-pencil
				td {{item.name}}
				td {{item.owner_name}}
				td {{item.price | formatCurrency}}
				td
					button.pull-right.btn.btn-danger(ng-click='delete(item.id)')
						span.glyphicon.glyphicon-trash			
			tr							
				form(method='post')
					input(type='hidden', name='_csrf', value=_csrf)
					input(type='hidden', name='shopping_list', value=shoppingList.id)
					input#select-owner(type='hidden', name='owner')
					div.input-group
						td
							div.input-group
								button.btn.btn-success(value='Erstellen' ng-click='insert()')
									span.glyphicon.glyphicon-plus-sign
						td
							input.form-control(type='text', name='name', placeholder='Produktname', ng-model='name')
						td
							div.btn-toolbar(role='toolbar', aria-label='bla2')
								div.btn-group.btn-group-sm(role='group', aria-label='bla')
									each member in members
										button.btn.btn-default(id='ownerButton.'+member.id type='button', onclick='updateActiveOwner('+member.id+')', data-id=member.id) 
											=member.name
										input(type='hidden' data-id=member.id value=member.id data-name=member.name)
						td(colspan="2")
							input.form-control(type='text', name='price', placeholder='Preis in €, z.B. 12.30', ng-model='price')
						script(type="application/javascript")
							|$('[id^="ownerButton"').on('click', function(e) {
							|	e.stopPropagation();
							|	updateActiveOwner();
							|});
							|function updateActiveOwner(memberID){
							|	var ids = [];
							|	if($('#ownerButton\\.'+memberID).hasClass("active")){
							|		$('#ownerButton\\.'+memberID).removeClass("active");
							|	} else {
							|		$('#ownerButton\\.'+memberID).addClass("active");
							|	}
							|	$('[id^="ownerButton"].active').each(function(index,element){
							|		ids.push($(this).attr("data-id"));
							|	});
							|	$('#select-owner').val(ids.join("|"));
							|};